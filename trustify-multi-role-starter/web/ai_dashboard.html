<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Trustify | AI Dashboard</title>
  <link rel="stylesheet" href="./style.css">
  <script src="./app.js"></script>
  <link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="#0b1020">
</head>
<body class="container">

<script>
// ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏â‡∏û‡∏≤‡∏∞ Brand ‡∏´‡∏£‡∏∑‡∏≠ Gov
const role = localStorage.getItem('role');
if (!['brand','gov'].includes(role)) {
  alert('‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ');
  location.replace('./login.html');
}
</script>

<div class="topbar">
  <div>üß† AI Analysis Dashboard</div>
  <div><a class="link" href="./login.html">Logout</a></div>
</div>

<h2>‡∏†‡∏≤‡∏û‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÇ‡∏î‡∏¢ AI</h2>
<div id="gallery" class="grid grid-2"></div>

<script>
const backend = localStorage.getItem('backend_url') || '';
const API = (p,o={}) => fetch(backend + p, o);

async function loadAnalyses(){
  try {
    const r = await API('/api/ai/all');
    const items = r.ok ? await r.json() : [];
    const g = document.getElementById('gallery');

    if (!items.length){
      g.innerHTML = '<div class="muted">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå</div>';
      return;
    }

    g.innerHTML = items.map(it => `
      <div class="card" style="padding:12px">
        <img src="${backend}${it.image_url}" style="max-width:100%;border-radius:8px"/>
        <div><b>${it.label}</b> (${it.score}%)</div>
        <div class="muted">GTIN: ${it.product_gtin || '-'}</div>
        <div class="muted">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ${new Date(it.processed_at).toLocaleString()}</div>
        <pre style="font-size:12px;white-space:pre-wrap;background:#00000033;padding:8px;border-radius:6px">${it.ocr_text || '(‡πÑ‡∏°‡πà‡∏°‡∏µ OCR)'}</pre>
      </div>
    `).join('');
  } catch (err){
    alert('‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
  }
}
loadAnalyses();
</script>
<a class="floating-assistant" href="./trustify-ai.html" title="Assistant">
  <img src="./assets/‡πÑ‡∏≠‡πÇ‡∏Å‡πâ.png" alt="Assistant">
</a>
</body>
</html>
